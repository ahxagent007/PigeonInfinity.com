{% extends 'base_main.html' %}

{% block title %}
{% endblock %}

{% block menu %}
    <ul class="navbar-nav ml-auto">
        <li class="nav-item"><a href="{{url_for('home')}}" class="nav-link">Home</a></li>
        <li class="nav-item"><a href="{{url_for('auction')}}" class="nav-link">Auction</a></li>
        <li class="nav-item"><a href="{{url_for('article')}}" class="nav-link">Articles</a></li>
        <li class="nav-item"><a href="{{url_for('club')}}" class="nav-link">Clubs</a></li>
        <li class="nav-item"><a href="{{url_for('buy')}}" class="nav-link">Buy Now</a></li>
        <li class="nav-item"><a href="{{url_for('contact')}}" class="nav-link">Contact</a></li>
        <li class="nav-item"><a href="{{url_for('about')}}" class="nav-link">About</a></li>
    </ul>
{% endblock %}

{% block body %}
    <section class="hero-wrap hero-wrap-2" style="background-image: url({{url_for('static', filename='UPLOADS/'+auc['MainPicture'])}});" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text align-items-end">
          <div class="col-md-9 ftco-animate pb-5">
              <h1 class="mb-0 bread">{{auc['AuctionName']}}</h1>
              <p class="breadcrumbs mb-2">{{auc['AuctionDetails']}}</p>

          </div>
        </div>
      </div>
    </section>

    {% if running %}
    <section class="ftco-counter" id="section-counter">
    	<div class="container">
				<div class="row">
          <div class="col-md-3 col-lg-3 d-flex justify-content-center counter-wrap ftco-animate">
            <div class="block-18 text-center">
              <div class="text">
                <strong class="number" data-number="2">0</strong>
              </div>
              <div class="text">
              	<span>Days</span>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-lg-3 d-flex justify-content-center counter-wrap ftco-animate">
            <div class="block-18 text-center">
              <div class="text">
                <strong class="number" data-number="12">0</strong>
              </div>
              <div class="text">
              	<span>Hours</span>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-lg-3 d-flex justify-content-center counter-wrap ftco-animate">
            <div class="block-18 text-center">
              <div class="text">
                <strong class="number" data-number="45">0</strong>
              </div>
              <div class="text">
              	<span>Minutes</span>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-lg-3 d-flex justify-content-center counter-wrap ftco-animate">
            <div class="block-18 text-center">
              <div class="text">
                <strong class="number" data-number="15">0</strong>
              </div>
              <div class="text">
              	<span>Seconds</span>
              </div>
            </div>
          </div>
        </div>
    	</div>
    </section>
    {% endif %}

    <section class="ftco-section bg-light">
      <div class="container">
        <div class="row justify-content-center pb-5 mb-3">
          <div class="col-md-7 heading-section text-center ftco-animate">
            <h2>Pigeons</h2>
          </div>
        </div>
        <div class="row d-flex">
          {% for p in pgs %}
          <div class="col-md-4 ftco-animate">
            <div class="blog-entry align-self-stretch">
              <a href="blog-single.html" class="block-20 rounded" style="background-image: url({{url_for('static', filename='UPLOADS/'+p['MainPic'])}});">
              </a>
              <div class="text p-4">
                <div class="meta mb-2">
                    <h3 class="heading"><a href="#">{{p['PigeonRing']}}</a></h3>

                  <div><a href="#">{{p['PigeonName']}}</a></div><br>
                  <div><a href="#">Breed by: {{p['BreedBy']}}</a></div><br>
                  <div><a href="#">Offer by: {{p['OfferBy']}}</a></div><br>
                  <div><a href="#" class="meta-chat"><span class="fa fa-gavel"></span> {{p['Price']}} {{auc['Currency']}}</a></div><br>
                  <div><a href="#">Last bid by: {{p['LastbidderName']}}</a></div><br>
                  <div><h4 class="heading">{{p['EndTime']}}</h4></div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>


{% endblock %}

{% block custom_js %}
    <script type="text/javascript">

        //let runningAuc = "{{runningAuc|length}}";

        function EndingTimeDiff(endingTime) {

            let DateTime = luxon.DateTime;
            let now = DateTime.local().setZone('Asia/Dhaka')
            let nowMilis = now. toMillis();

            console.log(nowMilis);
            /*let year    = now.year;
            let month   = now.month;
            let day     = now.day;
            let hour    = now.hour;
            let minute  = now.minute;
            let second  = now.second;*/

            //let y = endingTime.substring(0,3);
            //console.log(y);

            let auctionEndDateTime = new Date(endingTime);
            let aucEndsMilis = auctionEndDateTime.getTime();
            //console.log(aucEndsMilis);

            endsIn = aucEndsMilis - nowMilis;

            if(endsIn<=0){
                location.reload();
            }

            days = parseInt(endsIn/86400000);
            hours = parseInt((endsIn%86400000)/3600000);
            mins = parseInt((endsIn%3600000)/60000);
            secs = parseInt((endsIn%60000)/1000);

            /*let Y = auctionEndDateTime.getFullYear();
            let M = auctionEndDateTime.getMonth();
            let D = auctionEndDateTime.getDate();
            let H = auctionEndDateTime.getHours();
            let S = auctionEndDateTime.getSeconds();
            let ms = auctionEndDateTime.getMilliseconds();*/

            let ends = days+' days '+hours+' hours '+mins+' minutes '+secs+' seconds';
            //console.log(ends);
            return ends;
        }

        let runningAuc = {{runningAuc|safe}};
        console.log(runningAuc);

        setInterval(function(){
                let i;
                for(i=0; i<runningAuc.length; i++){
                    endingTime = EndingTimeDiff(runningAuc[i]['AuctionEnd']);
                    document.getElementById("ends"+runningAuc[i]['AuctionID']).innerHTML = endingTime;
                }

            }, 1000);



</script>
{% endblock %}